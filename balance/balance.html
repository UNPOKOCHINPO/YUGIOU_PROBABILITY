<!DOCTYPE html>
<html>

<head>
    <title>Best Balance</title>
    <link rel="stylesheet" href="../calc_page_css.css">
</head>

<body>
    <h1>手札のバランスに最適なデッキバランスを取得</h1>
    <h2>このページでできること</h2>
    <div class="text-box">
        遊戯王のデッキ構築において、手札に来るモンスターと魔法罠の比率は重要です。例えば、魔弾デッキであれば、モンスター1枚か2枚、残りは妨害系の魔法罠を引くことが望ましいでしょう。<br>
        要するに初手5枚で、(モンスター, 魔法罠)=(1, 4)のような手札になって欲しいわけです。
        <br>
        このページでは、欲しい手札を入力すると、モンスターを何枚デッキに入れれば良いか自動で算出し、最適なデッキ構築を教えてくれます。<br>
        それだけでなく、最適なデッキ構築にしたときに、全パターンの手札の確率も算出できるようにしました。
        <br><br>
        例えば、以下の入力フォームに, 「40, 3」を入力すると、40枚デッキにおいて、(モンスター、魔法罠)の比率が(3,2)になるような確率が最も大きくなるデッキ構築が計算されます。<br>
        この場合では、デッキに入れるべきモンスターの数は24枚になります。<br>
        さらに、モンスターを24枚デッキにいれたときに、(モンスター、魔法罠)の比率がそれぞれ(0,5),(1,4),(2,3),(3,2),(4,1),(5,0)になる確率も実際に確認できます。
    </div>

    <h2>入力フォーム</h2>
    <form id="sumForm">
        <label for="n">デッキ枚数：</label>
        <input type="number" id="n" required><br>

        <label for="m">引きたいモンスターの枚数：</label>
        <input type="number" id="m" required><br>


        <input type="button" value="計算" onclick="calculateAndDisplaySum()">
    </form>

    <pre id="result"></pre>
    <pre id="probs"></pre>

    <h1>数値の比較棒グラフ</h1>
    <canvas id="barChart" width="600" height="200"></canvas>

    <script type="text/javascript" src="balance.js"></script>
    <script>
        function drawBarChart(n, best_m) {
            const list = get_list_of_hands_prob(n, best_m)

            // グラフの描画
            const canvas = document.getElementById('barChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const maxValue = 100; // 縦軸の最大値を1に設定
            const barWidth = 60;
            const barMargin = 20;
            const chartHeight = canvas.height - 40;
            const chartWidth = barWidth * (list.length) + barMargin * (list.length - 1);
            const startX = (canvas.width - chartWidth) / 2;
            const startY = canvas.height - 20;


            // Draw y-axis grid lines and labels
            ctx.beginPath();
            const gridCount = 10;
            const gridGap = chartHeight / gridCount;
            for (let i = 0; i <= gridCount; i++) {
                const y = startY - i * gridGap;
                ctx.moveTo(startX, y);
                ctx.lineTo(canvas.width - startX, y);

                // Draw y-axis labels on the left
                const value = i * 0.1;
                ctx.textAlign = "center"; // テキストを右寄せに
                ctx.fillStyle = '#fff'; // テキストを白色に
                ctx.fillText(value.toFixed(1), startX - 10, y + 5);
            }

            ctx.strokeStyle = '#666';
            ctx.stroke();


            // Draw goyoku bar
            for (let i = 0; i < list.length; i++) {
                ctx.fillStyle = 'white';
                ctx.fillRect(startX + (barWidth + barMargin) * i, startY - list[i] / maxValue * chartHeight, barWidth, list[i] / maxValue * chartHeight);
                ctx.fillText('(' + i + ', ' + (list.length - i - 1) + ')', startX + (barWidth + barMargin) * i + barWidth / 2, startY + 15);
            }
        }

    </script>

    <script>
        function calculateAndDisplaySum() {
            const n = parseInt(document.getElementById('n').value);
            const m = parseInt(document.getElementById('m').value);

            best_m = find_best_balance_of_deck(n, m);
            const list = get_list_of_hands_prob(n, best_m)

            // 結果の表示
            document.getElementById('result').innerText = "デッキ内に入れるべきモンスターの数：" + best_m;

            probs = ""
            for (let i = 0; i < list.length; i++) {
                probs = probs + "(モンスター:魔法罠)=(" + i + "," + (5 - i) + ") : " + Math.round(list[i] * 100) / 100 + "%\n";
            }
            document.getElementById('probs').innerText = probs

            drawBarChart(n, best_m);
        }
    </script>
</body>

</html>